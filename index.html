<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fragmentos de Invierno</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Paleta extraída de tus imágenes "Romance Frío" */
            --col-bg-dark: #153548;      /* Azul profundo (Imagen 2) */
            --col-bg-panel: #1A545D;     /* Teal oscuro (Imagen 2) */
            --col-accent-cold: #9AE8B7;  /* Menta helado (Imagen 2 - Texto) */
            --col-accent-love: #F55654;  /* Rosa rojizo (Imagen 3 - Corazón) */
            --col-text-dim: #817063;     /* Taupe (Imagen 2 - Detalles) */
            --col-shadow: #0a1a24;       /* Sombra profunda */
            
            --pixel-size: 4px;
        }

        body {
            background-color: var(--col-bg-dark);
            font-family: 'VT323', monospace;
            margin: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            color: var(--col-accent-cold);
            position: relative;
        }

        /* --- Efectos Ambientales --- */
        .scanlines {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 10;
        }
        
        .vignette {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 50%, black 150%);
            pointer-events: none;
            z-index: 9;
        }

        /* --- Componentes Pixel Art --- */
        .pixel-card {
            background-color: var(--col-bg-panel);
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            position: relative;
            text-align: center;
            /* Sombras duras para efecto pixel 3D */
            box-shadow: 
                -4px 0 0 0 var(--col-shadow),
                4px 0 0 0 var(--col-shadow),
                0 -4px 0 0 var(--col-shadow),
                0 4px 0 0 var(--col-shadow),
                8px 8px 0 0 rgba(0,0,0,0.5);
        }

        .pixel-heart {
            color: var(--col-accent-love);
            font-size: 3rem;
            text-shadow: 4px 4px 0px var(--col-shadow);
            animation: beat 3s infinite ease-in-out;
            margin-bottom: 1rem;
            display: inline-block;
        }

        h1 {
            font-family: 'Press Start 2P', cursive;
            font-size: 1.2rem;
            line-height: 1.5;
            margin-bottom: 1rem;
            color: var(--col-accent-cold);
            text-shadow: 2px 2px 0px var(--col-shadow);
        }

        p {
            font-size: 1.4rem;
            color: #d1e8e6;
            margin-bottom: 2rem;
        }

        /* --- Inputs y Botones --- */
        .pixel-input {
            width: 80%;
            background: var(--col-bg-dark);
            border: 2px solid var(--col-text-dim);
            color: var(--col-accent-love);
            font-family: 'Press Start 2P', cursive;
            font-size: 0.8rem;
            padding: 15px;
            text-align: center;
            outline: none;
            margin-bottom: 15px;
            box-shadow: inset 4px 4px 0px rgba(0,0,0,0.5);
        }
        
        .pixel-input::placeholder { color: #354c57; }

        .pixel-btn {
            background-color: var(--col-accent-love);
            color: var(--col-bg-dark);
            border: none;
            padding: 15px 30px;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.8rem;
            cursor: pointer;
            box-shadow: 
                inset 4px 4px 0px rgba(255,255,255,0.3),
                inset -4px -4px 0px rgba(0,0,0,0.3),
                4px 4px 0px var(--col-shadow);
            transition: transform 0.1s;
        }

        .pixel-btn:active {
            transform: translate(4px, 4px);
            box-shadow: none;
        }

        .btn-secondary {
            background-color: var(--col-text-dim);
            color: white;
            font-size: 0.6rem;
            padding: 10px;
        }

        /* --- Panel de Admin (Oculto) --- */
        #admin-panel {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            border: 4px solid var(--col-accent-love);
            background-color: black;
            display: none; /* Se activa con JS */
        }

        .admin-trigger {
            position: fixed;
            bottom: 10px;
            right: 10px;
            opacity: 0.3;
            font-family: 'Press Start 2P';
            font-size: 10px;
            cursor: pointer;
            color: var(--col-text-dim);
        }
        .admin-trigger:hover { opacity: 1; }

        .key-list {
            list-style: none;
            padding: 0;
            max-height: 100px;
            overflow-y: auto;
            text-align: left;
            border: 2px dashed var(--col-text-dim);
            padding: 10px;
            margin: 10px 0;
            font-size: 1.2rem;
        }
        .key-item { color: var(--col-accent-cold); margin-bottom: 5px; }

        /* --- Animaciones --- */
        @keyframes beat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .error-msg { color: var(--col-accent-love); font-size: 1.2rem; margin-top: 10px; min-height: 1.5rem;}
        .success-msg { color: var(--col-accent-cold); font-size: 1.2rem; margin-top: 10px; min-height: 1.5rem;}

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="scanlines"></div>
    <div class="vignette"></div>

    <main class="pixel-card" id="login-card">
        <div class="pixel-heart">❤</div>
        <h1>SOLO UNA VEZ<br>PUEDES ENTRAR</h1>
        <p>El invierno guarda secretos.<br>Introduce tu llave única.</p>
        
        <input type="text" id="user-key" class="pixel-input" placeholder="XXXX-XXXX" maxlength="10">
        <br>
        <button class="pixel-btn" onclick="tryLogin()">ABRIR PORTAL</button>
        
        <div id="login-msg" class="error-msg"></div>
    </main>

    <main class="pixel-card hidden" id="content-card">
        <div class="pixel-heart" style="color:var(--col-accent-cold)">❄</div>
        <h1>ACCESO CONCEDIDO</h1>
        <p>Esta llave se ha roto para siempre.<br>Bienvenido al recuerdo.</p>
        <div style="border: 2px dashed var(--col-accent-love); padding: 20px; margin-top:20px;">
            <p style="color: white; margin:0;">
                "Aquí iría tu carta, tu foto o el siguiente paso de tu página web..."
            </p>
        </div>
    </main>

    <div class="admin-trigger" onclick="toggleAdmin()">[ ⚙ ]</div>

    <div id="admin-panel" class="pixel-card">
        <h1 style="color:var(--col-accent-love)">ZONA DE CONTROL</h1>
        
        <div id="admin-login-view">
            <p>Contraseña Maestra:</p>
            <input type="password" id="admin-pass" class="pixel-input">
            <button class="pixel-btn btn-secondary" onclick="checkAdminPass()">ENTRAR</button>
        </div>

        <div id="admin-controls-view" class="hidden">
            <p>Generar Llave Única:</p>
            <button class="pixel-btn" onclick="generateKey()">CREAR LLAVE</button>
            <ul id="key-display" class="key-list">
                </ul>
            <button class="pixel-btn btn-secondary" onclick="toggleAdmin()">CERRAR</button>
        </div>
    </div>

    <script>
        // --- CONFIGURACIÓN ---
        const DB_NAME = "romance_frio_db_v1";
        const ADMIN_PASSWORD = "AMOR_FRIO"; // <--- CAMBIA ESTO SI QUIERES

        // --- REFERENCIAS DOM ---
        const userKeyInput = document.getElementById('user-key');
        const loginMsg = document.getElementById('login-msg');
        const loginCard = document.getElementById('login-card');
        const contentCard = document.getElementById('content-card');
        
        const adminPanel = document.getElementById('admin-panel');
        const adminPassInput = document.getElementById('admin-pass');
        const adminLoginView = document.getElementById('admin-login-view');
        const adminControlsView = document.getElementById('admin-controls-view');
        const keyDisplayList = document.getElementById('key-display');

        // --- SISTEMA DE BASE DE DATOS (LocalStorage) ---
        // Iniciamos la "Base de datos" si no existe
        let db = JSON.parse(localStorage.getItem(DB_NAME)) || {
            activeKeys: [], // Llaves que funcionan
            usedKeys: []    // Llaves ya gastadas
        };

        function saveDB() {
            localStorage.setItem(DB_NAME, JSON.stringify(db));
        }

        // --- LÓGICA DEL USUARIO (Entrar) ---
        function tryLogin() {
            const input = userKeyInput.value.trim().toUpperCase();
            loginMsg.textContent = "";

            if (!input) {
                loginMsg.textContent = "Necesitas una llave.";
                return;
            }

            // 1. Verificamos si la llave es válida (está en activeKeys)
            const index = db.activeKeys.indexOf(input);

            if (index !== -1) {
                // ¡ÉXITO!
                // 2. Invalidamos la llave (la movemos a usadas)
                db.activeKeys.splice(index, 1);
                db.usedKeys.push(input);
                saveDB();

                // 3. Mostramos animación y contenido
                loginMsg.className = "success-msg";
                loginMsg.textContent = "Llave aceptada...";
                
                setTimeout(() => {
                    loginCard.classList.add('hidden');
                    contentCard.classList.remove('hidden');
                }, 1500);

            } else if (db.usedKeys.includes(input)) {
                // ERROR: Ya se usó
                loginMsg.className = "error-msg";
                loginMsg.textContent = "Esta llave ya fue usada y se rompió.";
            } else {
                // ERROR: No existe
                loginMsg.className = "error-msg";
                loginMsg.textContent = "Esa llave no encaja aquí.";
            }
        }

        // --- LÓGICA DE ADMINISTRADOR (Generar) ---
        function toggleAdmin() {
            if (adminPanel.style.display === 'block') {
                adminPanel.style.display = 'none';
                // Resetear vista al cerrar
                adminLoginView.classList.remove('hidden');
                adminControlsView.classList.add('hidden');
                adminPassInput.value = "";
            } else {
                adminPanel.style.display = 'block';
            }
        }

        function checkAdminPass() {
            if (adminPassInput.value === ADMIN_PASSWORD) {
                adminLoginView.classList.add('hidden');
                adminControlsView.classList.remove('hidden');
                renderKeys();
            } else {
                alert("Acceso Denegado");
            }
        }

        function generateKey() {
            // Genera string aleatorio de 6 caracteres
            const newKey = Math.random().toString(36).substring(2, 8).toUpperCase();
            
            db.activeKeys.push(newKey);
            saveDB();
            renderKeys();
        }

        function renderKeys() {
            keyDisplayList.innerHTML = "";
            if (db.activeKeys.length === 0) {
                keyDisplayList.innerHTML = "<li class='key-item'>No hay llaves activas.</li>";
                return;
            }
            // Mostrar últimas creadas primero
            db.activeKeys.slice().reverse().forEach(key => {
                const li = document.createElement('li');
                li.className = 'key-item';
                li.textContent = `>> ${key}`;
                keyDisplayList.appendChild(li);
            });
        }

    </script>
</body>
</html>
